# Lab - Known vulnerability exploits 
## Lab -01 exploiting SMB vulnerability 
### Enumeration of SMB Vulnerability using enum4linux
In this lab, you will complete the following objectives:

    - Launch enum4linux and explore its capabilities.
    - Identify computers with SMB services running.
    - Use enum4linux to enumerate users and network file shares.
    - Use smbclient to transfer files between systems.
Tools needed
- Kali linux
- enum4linux
- semba server running /windows server
- smbclient
Step one: check if the system is running Samba service
    - samba --version
Step two: run nmap to see if any system running smb service
   - nmap -sN target subnet (192.168.0.56/24)
     
  <img width="878" height="813" alt="Screenshot 2026-02-11 174538" src="https://github.com/user-attachments/assets/b67a0a6f-267d-456a-9724-f004d1f1610a" />
Step three:Creates user in the samba server accessing the smb service
   - create user
        - sudo useradd Alex
        - sudo passwd Alex (provide a password for the user)
        - sudo useradd Matt
        - sudo passwd Matt (provide a password for the user)
Step four: creates Samba users
    - create the samba user
       - sudo smbpasswd -a Alex
       - sudo smbpasswd -a Matt
    - Enable the users on the samba server
        - sudo smbpasswd -e Alex
        - sudo smbpasswd -e Matt
 Step five: configure samba to enable enum4linux scan
     - sudo nano /etc/samba/smb.conf
 - [global]
   - workgroup = WORKGROUP
   - server role = standalone server
   - security = user
   ### Allow enum4linux-style enumeration
   - restrict anonymous = no
   - map to guest = Bad User
 - Create a share (helps visibility)
   - [public]
       - path = /srv/samba/public
       - browsable = yes
       - writable = yes
       - guest ok = yes
 - Create a directory
      - sudo mkdir -p /srv/samba/public
      - sudo chmod 777 /srv/samba/public
 - check if the change has been accpeted in the conf file
       - testparm
 -Restart Samba again
     - sudo systemctl restart smbd
<img width="875" height="701" alt="Screenshot 2026-02-11 182139" src="https://github.com/user-attachments/assets/06973020-0733-406c-b543-e5604cdf6c7c" />

 Step six: Perform an enum4linux scan on target
    - enum4linux -U 192.168.0.65
<img width="896" height="716" alt="Screenshot 2026-02-14 041253" src="https://github.com/user-attachments/assets/b39f084f-b815-4b60-95dd-58178333292e" />

   - enum4linux -S 192.168.0.65
<img width="993" height="732" alt="Screenshot 2026-02-14 044625" src="https://github.com/user-attachments/assets/8bb4bdeb-8372-47f6-a562-5a7deb77f93b" />

  - To confirm a share exists and smb is wworking we can run smbclient
  - smbclient //192.168.0.65/public -N
  - smb: /> (a prompt will pop out)
    
<img width="910" height="406" alt="Screenshot 2026-02-14 044715" src="https://github.com/user-attachments/assets/c12bf264-585a-40b9-b7f5-bf8f758088d0" />


**Lessons Learned:**

By using the enum4linux scan, an attacker can identify existing user accounts on the SMB server, which may facilitate credential theft and enable targeted brute-force or password-spraying attacks. Additionally, the various enum4linux enumeration options allow attackers to discover available file shares and retrieve the server’s password policy. This information significantly lowers the attack effort by helping adversaries tailor their approach to the system’s security configuration.

### Exploiting SMB vulnerability using smbclient
Exploitation goal (via smbclient)

Using info from enum4linux, we will:

     - Access an SMB share
     - Read sensitive files
     - Upload a malicious file (or backdoor)
     - Abuse weak permissions / credentia
Step1: Connect to the share (no credentials)
    - smbclient //192.168.0.65/public -L
Step2: Enumerate the internal system/file shares
    - smb: /> ls
    - all the shared file will be listed and can easily be downloaded
Step3: Data exflitration/Downloading data
    - get badfile.txt
Step4: Upload any files/malicious
    - put test.txt/
    - put shell.sh (excutable files)
    - ls
    
<img width="877" height="715" alt="Screenshot 2026-02-14 105308" src="https://github.com/user-attachments/assets/06eb2615-47e5-4c4f-81ca-0b96672a9b3f" />

<img width="892" height="721" alt="Screenshot 2026-02-14 110457" src="https://github.com/user-attachments/assets/b68bfa90-8abc-4464-b8b0-f5aff98e5060" />

